<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CORS :: Spring</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Spring</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Why Spring</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Reactive</a>
            <a class="navbar-item" href="#">Event Driven</a>
            <a class="navbar-item" href="#">Cloud</a>
            <a class="navbar-item" href="#">Web Applications</a>
            <a class="navbar-item" href="#">Serverless</a>
            <a class="navbar-item" href="#">Batch</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Overview</a>
            <a class="navbar-item" href="#">Quickstart</a>
            <a class="navbar-item" href="#">Guides</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Overview</a>
            <a class="navbar-item" href="#">Spring Boot</a>
            <a class="navbar-item" href="#">...</a>
          </div>
        </div>

        <a class="navbar-item" href="#">Training</a>
        <a class="navbar-item" href="#">Support</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Overview</a>
            <a class="navbar-item" href="#">Events</a>
            <a class="navbar-item" href="#">Team</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="framework" data-version="5.3.8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Spring Framework</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../core.html">Core</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../data-access.html">Data Access</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../web.html">Web Servlet</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../web-reactive.html">Web Reactive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../integration.html">Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../languages.html">Languages</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Spring Framework</span>
    <span class="version">5.3.8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Spring Framework</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">5.3.8</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../security/5.6.0/overview/prerequisites.html">Spring Security</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/5.6.0/overview/prerequisites.html">5.6.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Spring Framework</a></li>
    <li><a href="webflux-cors.html">CORS</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rwinch/spring-framework/edit/antora-2.x/src/docs/antora/modules/ROOT/pages/web/webflux-cors.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">CORS</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Spring WebFlux lets you handle CORS (Cross-Origin Resource Sharing). This section
describes how to do so.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux-cors-intro"><a class="anchor" href="#webflux-cors-intro"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="small"><a href="../web.html#mvc-cors-intro" class="page">Web MVC</a></span></p>
</div>
<div class="paragraph">
<p>For security reasons, browsers prohibit AJAX calls to resources outside the current origin.
For example, you could have your bank account in one tab and evil.com in another. Scripts
from evil.com should not be able to make AJAX requests to your bank API with your
credentials&#8201;&#8212;&#8201;for example, withdrawing money from your account!</p>
</div>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is a <a href="https://www.w3.org/TR/cors/">W3C specification</a>
implemented by <a href="https://caniuse.com/#feat=cors">most browsers</a> that lets you specify
what kind of cross-domain requests are authorized, rather than using less secure and less
powerful workarounds based on IFRAME or JSONP.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux-cors-processing"><a class="anchor" href="#webflux-cors-processing"></a>Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="small"><a href="../web.html#mvc-cors-processing" class="page">Web MVC</a></span></p>
</div>
<div class="paragraph">
<p>The CORS specification distinguishes between preflight, simple, and actual requests.
To learn how CORS works, you can read
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">this article</a>, among
many others, or see the specification for more details.</p>
</div>
<div class="paragraph">
<p>Spring WebFlux <code>HandlerMapping</code> implementations provide built-in support for CORS. After successfully
mapping a request to a handler, a <code>HandlerMapping</code> checks the CORS configuration for the
given request and handler and takes further actions. Preflight requests are handled
directly, while simple and actual CORS requests are intercepted, validated, and have the
required CORS response headers set.</p>
</div>
<div class="paragraph">
<p>In order to enable cross-origin requests (that is, the <code>Origin</code> header is present and
differs from the host of the request), you need to have some explicitly declared CORS
configuration. If no matching CORS configuration is found, preflight requests are
rejected. No CORS headers are added to the responses of simple and actual CORS requests
and, consequently, browsers reject them.</p>
</div>
<div class="paragraph">
<p>Each <code>HandlerMapping</code> can be
{api-spring-framework}/web/reactive/handler/AbstractHandlerMapping.html#setCorsConfigurations-java.util.Map-[configured]
individually with URL pattern-based <code>CorsConfiguration</code> mappings. In most cases, applications
use the WebFlux Java configuration to declare such mappings, which results in a single,
global map passed to all <code>HandlerMapping</code> implementations.</p>
</div>
<div class="paragraph">
<p>You can combine global CORS configuration at the <code>HandlerMapping</code> level with more
fine-grained, handler-level CORS configuration. For example, annotated controllers can use
class- or method-level <code>@CrossOrigin</code> annotations (other handlers can implement
<code>CorsConfigurationSource</code>).</p>
</div>
<div class="paragraph">
<p>The rules for combining global and local configuration are generally additive&#8201;&#8212;&#8201;for example,
all global and all local origins. For those attributes where only a single value can be
accepted, such as <code>allowCredentials</code> and <code>maxAge</code>, the local overrides the global value. See
{api-spring-framework}/web/cors/CorsConfiguration.html#combine-org.springframework.web.cors.CorsConfiguration-[<code>CorsConfiguration#combine(CorsConfiguration)</code>]
for more details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To learn more from the source or to make advanced customizations, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CorsConfiguration</code></p>
</li>
<li>
<p><code>CorsProcessor</code> and <code>DefaultCorsProcessor</code></p>
</li>
<li>
<p><code>AbstractHandlerMapping</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux-cors-controller"><a class="anchor" href="#webflux-cors-controller"></a><code>@CrossOrigin</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="small"><a href="../web.html#mvc-cors-controller" class="page">Web MVC</a></span></p>
</div>
<div class="paragraph">
<p>The {api-spring-framework}/web/bind/annotation/CrossOrigin.html[<code>@CrossOrigin</code>]
annotation enables cross-origin requests on annotated controller methods, as the
following example shows:</p>
</div>
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RestController
@RequestMapping("/account")
public class AccountController {

	@CrossOrigin
	@GetMapping("/{id}")
	public Mono&lt;Account&gt; retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping("/{id}")
	public Mono&lt;Void&gt; remove(@PathVariable Long id) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@RestController
@RequestMapping("/account")
class AccountController {

	@CrossOrigin
	@GetMapping("/{id}")
	suspend fun retrieve(@PathVariable id: Long): Account {
		// ...
	}

	@DeleteMapping("/{id}")
	suspend fun remove(@PathVariable id: Long) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>@CrossOrigin</code> allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All origins.</p>
</li>
<li>
<p>All headers.</p>
</li>
<li>
<p>All HTTP methods to which the controller method is mapped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>allowCredentials</code> is not enabled by default, since that establishes a trust level
that exposes sensitive user-specific information (such as cookies and CSRF tokens) and
should be used only where appropriate. When it is enabled either <code>allowOrigins</code> must be
set to one or more specific domain (but not the special value <code>"*"</code>) or alternatively
the <code>allowOriginPatterns</code> property may be used to match to a dynamic set of origins.</p>
</div>
<div class="paragraph">
<p><code>maxAge</code> is set to 30 minutes.</p>
</div>
<div class="paragraph">
<p><code>@CrossOrigin</code> is supported at the class level, too, and inherited by all methods.
The following example specifies a certain domain and sets <code>maxAge</code> to an hour:</p>
</div>
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CrossOrigin(origins = "https://domain2.com", maxAge = 3600)
@RestController
@RequestMapping("/account")
public class AccountController {

	@GetMapping("/{id}")
	public Mono&lt;Account&gt; retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping("/{id}")
	public Mono&lt;Void&gt; remove(@PathVariable Long id) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@CrossOrigin("https://domain2.com", maxAge = 3600)
@RestController
@RequestMapping("/account")
class AccountController {

	@GetMapping("/{id}")
	suspend fun retrieve(@PathVariable id: Long): Account {
		// ...
	}

	@DeleteMapping("/{id}")
	suspend fun remove(@PathVariable id: Long) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>@CrossOrigin</code> at both the class and the method level,
as the following example shows:</p>
</div>
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@CrossOrigin(maxAge = 3600) <i class="conum" data-value="1"></i><b>(1)</b>
@RestController
@RequestMapping("/account")
public class AccountController {

	@CrossOrigin("https://domain2.com") <i class="conum" data-value="2"></i><b>(2)</b>
	@GetMapping("/{id}")
	public Mono&lt;Account&gt; retrieve(@PathVariable Long id) {
		// ...
	}

	@DeleteMapping("/{id}")
	public Mono&lt;Void&gt; remove(@PathVariable Long id) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>@CrossOrigin</code> at the class level.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>@CrossOrigin</code> at the method level.</td>
</tr>
</table>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@CrossOrigin(maxAge = 3600) <i class="conum" data-value="1"></i><b>(1)</b>
@RestController
@RequestMapping("/account")
class AccountController {

	@CrossOrigin("https://domain2.com") <i class="conum" data-value="2"></i><b>(2)</b>
	@GetMapping("/{id}")
	suspend fun retrieve(@PathVariable id: Long): Account {
		// ...
	}

	@DeleteMapping("/{id}")
	suspend fun remove(@PathVariable id: Long) {
		// ...
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>@CrossOrigin</code> at the class level.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>@CrossOrigin</code> at the method level.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux-cors-global"><a class="anchor" href="#webflux-cors-global"></a>Global Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="small"><a href="../web.html#mvc-cors-global" class="page">Web MVC</a></span></p>
</div>
<div class="paragraph">
<p>In addition to fine-grained, controller method-level configuration, you probably want to
define some global CORS configuration, too. You can set URL-based <code>CorsConfiguration</code>
mappings individually on any <code>HandlerMapping</code>. Most applications, however, use the
WebFlux Java configuration to do that.</p>
</div>
<div class="paragraph">
<p>By default global configuration enables the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All origins.</p>
</li>
<li>
<p>All headers.</p>
</li>
<li>
<p><code>GET</code>, <code>HEAD</code>, and <code>POST</code> methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>allowedCredentials</code> is not enabled by default, since that establishes a trust level
that exposes sensitive user-specific information( such as cookies and CSRF tokens) and
should be used only where appropriate. When it is enabled either <code>allowOrigins</code> must be
set to one or more specific domain (but not the special value <code>"*"</code>) or alternatively
the <code>allowOriginPatterns</code> property may be used to match to a dynamic set of origins.</p>
</div>
<div class="paragraph">
<p><code>maxAge</code> is set to 30 minutes.</p>
</div>
<div class="paragraph">
<p>To enable CORS in the WebFlux Java configuration, you can use the <code>CorsRegistry</code> callback,
as the following example shows:</p>
</div>
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableWebFlux
public class WebConfig implements WebFluxConfigurer {

	@Override
	public void addCorsMappings(CorsRegistry registry) {

		registry.addMapping("/api/**")
			.allowedOrigins("https://domain2.com")
			.allowedMethods("PUT", "DELETE")
			.allowedHeaders("header1", "header2", "header3")
			.exposedHeaders("header1", "header2")
			.allowCredentials(true).maxAge(3600);

		// Add more mappings...
	}
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Configuration
@EnableWebFlux
class WebConfig : WebFluxConfigurer {

	override fun addCorsMappings(registry: CorsRegistry) {

		registry.addMapping("/api/**")
				.allowedOrigins("https://domain2.com")
				.allowedMethods("PUT", "DELETE")
				.allowedHeaders("header1", "header2", "header3")
				.exposedHeaders("header1", "header2")
				.allowCredentials(true).maxAge(3600)

		// Add more mappings...
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="webflux-cors-webfilter"><a class="anchor" href="#webflux-cors-webfilter"></a>CORS <code>WebFilter</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="small"><a href="../web.html#mvc-cors-filter" class="page">Web MVC</a></span></p>
</div>
<div class="paragraph">
<p>You can apply CORS support through the built-in
{api-spring-framework}/web/cors/reactive/CorsWebFilter.html[<code>CorsWebFilter</code>], which is a
good fit with <a href="#webflux-fn">functional endpoints</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you try to use the <code>CorsFilter</code> with Spring Security, keep in mind that Spring
Security has
<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#cors">built-in support</a>
for CORS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the filter, you can declare a <code>CorsWebFilter</code> bean and pass a
<code>CorsConfigurationSource</code> to its constructor, as the following example shows:</p>
</div>
<div class="listingblock primary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
CorsWebFilter corsFilter() {

	CorsConfiguration config = new CorsConfiguration();

	// Possibly...
	// config.applyPermitDefaultValues()

	config.setAllowCredentials(true);
	config.addAllowedOrigin("https://domain1.com");
	config.addAllowedHeader("*");
	config.addAllowedMethod("*");

	UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
	source.registerCorsConfiguration("/**", config);

	return new CorsWebFilter(source);
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Bean
fun corsFilter(): CorsWebFilter {

	val config = CorsConfiguration()

	// Possibly...
	// config.applyPermitDefaultValues()

	config.allowCredentials = true
	config.addAllowedOrigin("https://domain1.com")
	config.addAllowedHeader("*")
	config.addAllowedMethod("*")

	val source = UrlBasedCorsConfigurationSource().apply {
		registerCorsConfiguration("/**", config)
	}
	return CorsWebFilter(source)
}</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
